<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íšŒì˜ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">

  <!-- í—¤ë” -->
  <header class="bg-teal-600 text-white py-6">
    <h1 class="text-center text-4xl font-bold">íšŒì˜ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
  </header>

  <!-- ì˜ˆì•½ í¼ -->
  <section class="p-8 flex justify-center">
    <div class="w-full max-w-4xl">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800">ğŸ“… íšŒì˜ì‹¤ ì˜ˆì•½í•˜ê¸°</h2>
      <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
        <div>
          <label class="block text-sm font-medium text-gray-700">ì˜ˆì•½ì ëª…</label>
          <input id="reserver-name" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="mt-2 p-3 block w-full rounded-md border-gray-300 shadow-md focus:border-teal-500 focus:ring focus:ring-teal-300">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">ì˜ˆì•½ ë‚ ì§œ</label>
          <input id="reservation-date" type="date" class="mt-2 p-3 block w-full rounded-md border-gray-300 shadow-md focus:border-teal-500 focus:ring focus:ring-teal-300">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">ì‹œê°„ ì„ íƒ</label>
          <select id="reservation-time" class="mt-2 p-3 block w-full rounded-md border-gray-300 shadow-md focus:border-teal-500 focus:ring focus:ring-teal-300"></select>
        </div>
      </div>
      <button id="reserve-btn" class="mt-8 bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-md transition-all duration-200">
        ì˜ˆì•½í•˜ê¸°
      </button>
    </div>
  </section>

  <!-- ì˜ˆì•½ ìŠ¤ì¼€ì¤„ í‘œì‹œ -->
  <section class="p-8 flex justify-center">
    <div class="w-full max-w-5xl">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800">ğŸ“‹ íšŒì˜ì‹¤ ì˜ˆì•½ ìŠ¤ì¼€ì¤„</h2>
      <div class="overflow-x-auto">
        <table class="table-auto w-full text-center border border-collapse border-gray-300">
          <thead>
            <tr class="bg-teal-600 text-white">
              <th class="py-3 px-2 w-[10%]">ì‹œê°„</th> 
              <th class="w-[18%]">ì›”</th> 
              <th class="w-[18%]">í™”</th> 
              <th class="w-[18%]">ìˆ˜</th> 
              <th class="w-[18%]">ëª©</th> 
              <th class="w-[18%]">ê¸ˆ</th> 
            </tr>
          </thead>
          <tbody id="schedule-table-body" class="bg-white">
            <!-- ë™ì  ìŠ¤ì¼€ì¤„ -->
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script>
    const timeSlots = Array.from({ length: 10 }, (_, i) => `${i + 9}:00 - ${i + 10}:00`);
    const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];

    const nameInput = document.getElementById('reserver-name');
    const dateInput = document.getElementById('reservation-date');
    const timeInput = document.getElementById('reservation-time');
    const reserveBtn = document.getElementById('reserve-btn');
    const scheduleTableBody = document.getElementById('schedule-table-body');

    timeSlots.forEach(time => {
      const option = document.createElement('option');
      option.value = time;
      option.textContent = time;
      timeInput.appendChild(option);
    });

    async function loadReservations() {
      const response = await fetch('/reservations');
      const data = await response.json();
      return data;
    }

    async function renderSchedule() {
      scheduleTableBody.innerHTML = '';
      const reservations = await loadReservations();

      timeSlots.forEach(timeSlot => {
        const row = document.createElement('tr');
        
        // Time slot column with 10% width
        row.innerHTML = `<td class="py-3 px-2 border w-[10%]">${timeSlot}</td>`;
        
        days.forEach(day => {
          const cell = document.createElement('td');
          cell.classList.add('w-[18%]', 'border'); // 18% width for weekday columns
          const reservation = reservations.find(res => res.day === day && res.time === timeSlot);
          if (reservation) {
            cell.innerHTML = `
              <div class="flex justify-center items-center">
                <span class="mr-2">${reservation.name}</span>
                <button class="text-sm text-blue-600 underline" onclick="editReservation('${reservation._id}')">ìˆ˜ì •</button>
                <button class="text-sm text-red-600 underline ml-2" onclick="deleteReservation('${reservation._id}')">ì‚­ì œ</button>
              </div>
            `;
          }
          row.appendChild(cell);
        });

        scheduleTableBody.appendChild(row);
      });
    }

    async function addReservation(name, date, time) {
      const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][new Date(date).getDay()];

      if (!days.includes(dayOfWeek)) {
        alert('ì˜ˆì•½ì€ ì›”ìš”ì¼ë¶€í„° ê¸ˆìš”ì¼ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }

      const response = await fetch('/reservations', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, date, day: dayOfWeek, time })
      });

      if (response.ok) {
        renderSchedule();
      } else {
        alert('ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì…ë‹ˆë‹¤.');
      }
    }

    async function deleteReservation(id) {
      if (confirm('ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        await fetch(`/reservations/${id}`, { method: 'DELETE' });
        renderSchedule();
      }
    }

    async function editReservation(id) {
      const newName = prompt('ìƒˆ ì˜ˆì•½ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
      if (newName) {
        await fetch(`/reservations/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: newName })
        });
        renderSchedule();
      }
    }

    reserveBtn.addEventListener('click', () => {
      const name = nameInput.value.trim();
      const date = dateInput.value;
      const time = timeInput.value;

      if (!name || !date || !time) {
        alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      addReservation(name, date, time);
    });

    document.addEventListener('DOMContentLoaded', renderSchedule);
  </script>

</body>
</html>
